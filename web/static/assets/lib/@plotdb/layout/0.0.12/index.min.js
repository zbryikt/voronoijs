!function(){var u,t,r;function e(t,e){var r,n={}.hasOwnProperty;for(r in e)n.call(e,r)&&(t[r]=e[r]);return t}u="http://www.w3.org/2000/svg",t=function(t){return this._r="string"==typeof(t=null==t?{}:t).root?document.querySelector(t.root):t.root,this.opt=e({autoSvg:!0,round:!0},t),null==this.opt.watchResize&&(this.opt.watchResize=!0),this.evtHandler={},this.box={},this.node={},this.group={},this},r={wm:new WeakMap,ro:new ResizeObserver(function(t){return t.map(function(t){return r.wm.get(t.target).update()})}),add:function(t,e){return this.wm.set(t,e),this.ro.observe(t)},delete:function(t){return this.ro.unobserve(t),this.wm.delete(t)}},t.prototype=e(Object.create(Object.prototype),{on:function(t,e){var r;return((r=this.evtHandler)[t]||(r[t]=[])).push(e)},fire:function(t){for(var e,r,n,o,u=[],i=[],a=1,d=arguments.length;a<d;++a)i.push(arguments[a]);for(e=i,a=0,n=(r=this.evtHandler[t]||[]).length;a<n;++a)o=r[a],u.push(o.apply(this,e));return u},init:function(e){var o=this;return Promise.resolve().then(function(){var n,t;return o.opt.watchResize&&r.add(o._r,o),null!=o.opt.autoSvg&&!o.opt.autoSvg||((n=o._r.querySelector("[data-type=render] > svg"))||((n=document.createElementNS(u,"svg")).setAttribute("width","100%"),n.setAttribute("height","100%"),o._r.querySelector("[data-type=render]").appendChild(n)),Array.from(o._r.querySelectorAll("[data-type=layout] .pdl-cell[data-name]")).map(function(t,e){var r=t.getAttribute("data-name");if(!(o.node[r]=t).hasAttribute("data-only"))return(t=o._r.querySelector("g.pdl-cell[data-name="+r+"]"))||(t=document.createElementNS(u,"g"),n.appendChild(t),t.classList.add("pdl-cell"),t.setAttribute("data-name",r)),o.group[r]=t})),(t=e.apply(o))&&"function"==typeof t.then?t.then(function(){return o.update()}):o.update()})},destroy:function(){return r.delete(this._r)},_rebox:function(t){var e;return this.opt.round?((e={}).x=Math.round(t.x),e.width=Math.round(t.x+t.width)-e.x,e.y=Math.round(t.y),e.height=Math.round(t.y+t.height)-e.y,e):t},update:function(t){var o=this;if(this._r)return null!=t&&!t||this.fire("update"),this.rbox=this._rebox(this._r.getBoundingClientRect()),Array.from(this._r.querySelectorAll("[data-type=layout] .pdl-cell[data-name]")).map(function(t,e){var r,n=t.getAttribute("data-name");if(o.node[n]=t,o.box[n]=r=o._rebox(t.getBoundingClientRect()),r.x-=o.rbox.x,r.y-=o.rbox.y,!t.hasAttribute("data-only"))return o.group[n]=n=o._r.querySelector("g.pdl-cell[data-name="+n+"]"),n.setAttribute("transform","translate("+Math.round(r.x)+","+Math.round(r.y)+")"),n.layout={node:t,box:r}}),null==t||t?this.fire("render"):void 0},root:function(){return this._r},getBox:function(t,e){return(e=null!=e&&e)?this.box[t]:(e=this._rebox(this._r.getBoundingClientRect()),(t=this._rebox(this.getNode(t).getBoundingClientRect())).x-=e.x,t.y-=e.y,t)},getNode:function(t){return this.node[t]},getGroup:function(t){return this.group[t]},getNodes:function(){return e({},this.node)},getGroups:function(){return e({},this.group)}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.layout=t)}.call(this);
